! function (o) {
    "use strict";

    function t(o) {
        o.touches || (o.touches = o.originalEvent.touches)
    }

    function s(o, t) {
        t._startY = o.touches[0].pageY, t.opts.scrollArea == window ? (t._meHeight = p.height(), t._childrenHeight = l.height()) : (t._meHeight = t.$element.height(), t._childrenHeight = t.$element.children().height()), t._scrollTop = t.$scrollArea.scrollTop()
    }

    function e(t, s) {
        s._curY = t.touches[0].pageY, s._moveY = s._curY - s._startY, s._moveY > 0 ? s.direction = "down" : s._moveY < 0 && (s.direction = "up");
        var e = Math.abs(s._moveY);
        "" != s.opts.loadUpFn && s._scrollTop <= 0 && "down" == s.direction && (t.preventDefault(), s.insertDOM || (s.$element.prepend('<div class="' + s.opts.domUp.domClass + '"></div>'), s.insertDOM = !0), s.$domUp = o("." + s.opts.domUp.domClass), i(s.$domUp, 0), e <= s.opts.distance ? (s._offsetY = e, s.$domUp.html("").append(s.opts.domUp.domRefresh)) : e > s.opts.distance && e <= 2 * s.opts.distance ? (s._offsetY = s.opts.distance + .5 * (e - s.opts.distance), s.$domUp.html("").append(s.opts.domUp.domUpdate)) : s._offsetY = s.opts.distance + .5 * s.opts.distance + .2 * (e - 2 * s.opts.distance), s.$domUp.css({
            height: s._offsetY
        })), "" != s.opts.loadDownFn && s._childrenHeight <= s._meHeight + s._scrollTop && "up" == s.direction && (t.preventDefault(), s.insertDOM || (s.$element.append('<div class="' + s.opts.domDown.domClass + '"></div>'), s.insertDOM = !0), s.$domDown = o("." + s.opts.domDown.domClass), i(s.$domDown, 0), e <= s.opts.distance ? (s._offsetY = e, s.$domDown.html("").append(s.opts.domDown.domRefresh)) : e > s.opts.distance && e <= 2 * s.opts.distance ? (s._offsetY = s.opts.distance + .5 * (e - s.opts.distance), s.$domDown.html("").append(s.opts.domDown.domUpdate)) : s._offsetY = s.opts.distance + .5 * s.opts.distance + .2 * (e - 2 * s.opts.distance), s.$domDown.css({
            height: s._offsetY
        }), s.$scrollArea.scrollTop(s._offsetY + s._scrollTop))
    }

    function d(t) {
        var s = Math.abs(t._moveY);
        t.insertDOM && ("down" == t.direction ? (t.$domResult = t.$domUp, t.domLoad = t.opts.domUp.domLoad) : "up" == t.direction && (t.$domResult = t.$domDown, t.domLoad = t.opts.domDown.domLoad), i(t.$domResult, 300), s > t.opts.distance ? (t.$domResult.css({
            height: t.$domResult.children().height()
        }), t.$domResult.html("").append(t.domLoad), n(t)) : t.$domResult.css({
            height: "0"
        }).on("webkitTransitionEnd", function () {
            t.insertDOM = !1, o(this).remove()
        }), t._moveY = 0)
    }

    function n(o) {
        o.loading = !0, "" != o.opts.loadUpFn && "down" == o.direction ? o.opts.loadUpFn(o) : "" != o.opts.loadDownFn && "up" == o.direction && o.opts.loadDownFn(o)
    }

    function i(o, t) {
        o.css({
            "-webkit-transition": "all " + t + "ms",
            transition: "all " + t + "ms"
        })
    }
    var a, p = o(window),
		l = o(document);
    o.fn.dropload = function (o) {
        return new a(this, o)
    }, a = function (t, s) {
        var e = this;
        e.$element = o(t), e.insertDOM = !1, e.loading = !1, e.isLock = !1, e.init(s)
    }, a.prototype.init = function (n) {
        var i = this;
        i.opts = o.extend({}, {
            scrollArea: i.$element,
            domUp: {
                domClass: "dropload-up",
                domRefresh: '<div class="dropload-refresh">↓下拉刷新</div>',
                domUpdate: '<div class="dropload-update">↑释放更新</div>',
                domLoad: '<div class="dropload-load"><span class="loading"></span>加载中...</div>'
            },
            domDown: {
                domClass: "dropload-down",
                domRefresh: '<div class="dropload-refresh">↑上拉加载更多</div>',
                domUpdate: '<div class="dropload-update">↓释放加载</div>',
                domLoad: '<div class="dropload-load"><span class="loading"></span>加载中...</div>'
            },
            distance: 50,
            loadUpFn: "",
            loadDownFn: ""
        }, n), i.$scrollArea = i.opts.scrollArea == window ? p : i.opts.scrollArea, i.$element.on("touchstart", function (o) {
            i.loading || i.isLock || (t(o), s(o, i))
        }), i.$element.on("touchmove", function (o) {
            i.loading || i.isLock || (t(o, i), e(o, i))
        }), i.$element.on("touchend", function () {
            i.loading || i.isLock || d(i)
        })
    }, a.prototype.lock = function () {
        var o = this;
        o.isLock = !0
    }, a.prototype.unlock = function () {
        var o = this;
        o.isLock = !1
    }, a.prototype.resetload = function () {
        var t = this;
        t.$domResult && t.$domResult.css({
            height: "0"
        }).on("webkitTransitionEnd", function () {
            t.loading = !1, t.insertDOM = !1, o(this).remove()
        })
    }
}(window.Zepto || window.jQuery);