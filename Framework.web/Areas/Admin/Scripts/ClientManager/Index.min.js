$(function(){modules.get(enums.Modules.CACHE).setMenuDomain("会员管理",new function(){function e(){$("#client_manager_form").on("click","a[data-id='search_client_manager']",function(){u=!1;n.search(t,!1)}).on("click","a[data-id='forzen_client_manager']",o).on("click","a[data-id='sort_by_commission_client_manager']",function(){u=!0;r=r===0?1:0;n.search(t,!1)})}function o(){try{n.confirmDomainByMultiRows(t,function(r){for(var f=[],u=0;u<r.length;u++)f.push({ID:r[u].ID,iState:r[u].iState===1?0:1,sPhone:r[u].sPhone});i.post("/Admin/ClientManager/ForzenClients",f,function(){n.alertInfo("操作成功");n.search(t,!0)},function(t){n.alertErr(t.Msg)})},"您是否要对选中的用户进行冻结/解冻操作？","请至少选中一行信息以进行操作",null)}catch(r){n.alertErr(r.message)}}function s(){n.bindPaginationEvent(t,{idField:"ID",loadMsg:"正在加载...",toolbar:"#client_manager_grid_tool",fit:!0,fitColumns:!0,pagination:!0,rownumbers:!0,singleSelect:!1,columns:[[{field:"checkbox",checkbox:!0},{field:"sNickName",title:"昵称",align:"center",width:100},{field:"sPhone",title:"手机号",align:"center",width:100},{field:"iClientType",title:"角色",align:"center",width:100,formatter:function(n,t){switch(t.iClientType){case 0:return"普通会员";case 1:return"分享客"}}},{field:"iState",title:"状态",align:"center",width:100,formatter:function(n,t){return t.iState===1?"正常":"冻结"}},{field:"dAddTime",title:"注册时间",align:"center",width:100},{field:"iTotalPrice",title:"累计佣金",align:"center",width:100,formatter:function(n,t){return t.iTotalPrice===null?"N/A":t.iTotalPrice}},{field:"operator",title:"操作",align:"center",width:100,formatter:function(n,t){return"<a href='javascript:;' onclick='modules.get(enums.Modules.CACHE).getMenuDomain(\"会员管理\").clientDetail(\""+t.ID+'",'+t.iClientType+");'>详情<\/a>"}}]],onLoadSuccess:function(){},rowStyler:function(n,t){if(t.iState===0)return"background-color:gray;color:white"}},y).pagination("select")}function h(n,t){f=n;var i=$("<div/>");i.dialog({title:t===0?"普通用户详情":"分享客详情",width:800,height:400,cache:!1,href:"/Admin/ClientManager/ClientDetail",modal:!0,queryParams:{ID:n,iClientType:t},collapsible:!1,minimizable:!1,maximizable:!1,resizable:!1,buttons:[{text:"关闭",iconCls:"icon-cancel",handler:function(){$(i).dialog("close")}}],onClose:function(){$(i).dialog("destroy");i=null},onLoad:function(){a();t===1&&c()}})}function c(){n.bindPaginationEvent($("#client_shared_goods"),{idField:"ID",loadMsg:"正在加载...",fit:!0,fitColumns:!0,pagination:!0,rownumbers:!0,singleSelect:!0,columns:[[{field:"checkbox",checkbox:!0},{field:"sClientID",hidden:!0},{field:"sGoodsPictures",title:"商品图",align:"center",width:80,height:80,formatter:function(n){var t=n.split(",");return t.length>0?"<img src='{0}' style='height:80px;width:80px;'><\/img>".formate(t[0]):"<img src='../Content/img/noimg.png' style='height:80px;width:80px;'><\/img>"}},{field:"sGoodsName",title:"商品名称",align:"center",width:100},{field:"iPirce",title:"分享时价格",align:"center",width:100},{field:"sShopName",title:"所属店铺",align:"center",width:100},{field:"dInsertTime",hidden:!0}]],onLoadSuccess:function(){$(".datagrid-header-check input[type=checkbox]").remove()},rowStyler:function(){}},l).pagination("select")}function l(t,r){try{var u={};u.pageNumber=t;u.pageSize=r;u.ID=f;i.post("/Admin/ClientManager/LoadSharedGoods",u,function(n){n.Data!==null&&($("#client_shared_goods").datagrid("loadData",n.Data.Result),$("#client_shared_goods").datagrid("getPager").pagination({pageNumber:t,pageSize:r,total:n.Data.MaxCount}))},function(t){n.alertErr(t.Msg)})}catch(e){n.alertErr(e.message)}}function a(){n.bindPaginationEvent($("#client_his_orders"),{idField:"ID",loadMsg:"正在加载...",fit:!0,fitColumns:!0,pagination:!0,rownumbers:!0,singleSelect:!0,columns:[[{field:"checkbox",checkbox:!0},{field:"sOrderNo",title:"订单号",align:"center",width:100},{field:"sReceiverPhone",title:"购买人",align:"center",width:100},{field:"iTotalPrice",title:"订单总价",align:"center",width:100},{field:"iType",title:"订单分类",align:"center",width:100,formatter:function(n){switch(n){case 0:return"民宿";case 1:return"票务";case 2:return"周边"}}},{field:"dAddTime",title:"下单时间",align:"center",width:100},{field:"iState",title:"状态",align:"center",width:100,formatter:function(n){switch(n){case 0:return"待付款";case 1:return"待使用";case 2:return"待核销"}}},{field:"operator",title:"操作",align:"center",width:100,formatter:function(){}}]],onLoadSuccess:function(){$(".datagrid-header-check input[type=checkbox]").remove()},rowStyler:function(){}},v).pagination("select")}function v(t,r){try{var u={};u.pageNumber=t;u.pageSize=r;u.ID=f;i.post("/Admin/ClientManager/LoadClientOrders",u,function(n){n.Data!==null&&($("#client_his_orders").datagrid("loadData",n.Data.Result),$("#client_his_orders").datagrid("getPager").pagination({pageNumber:t,pageSize:r,total:n.Data.MaxCount}))},function(t){n.alertErr(t.Msg)})}catch(e){n.alertErr(e.message)}}function y(f,e){try{if($("#client_manager_form").form("validate")){var o=$("#client_manager_form").serializeObject();o.pageNumber=f;o.pageSize=e;o.sort=r;o.sortable=u;i.post("/Admin/ClientManager/LoadClients",o,function(n){n.Data!==null&&(t.datagrid("loadData",n.Data.Result),t.datagrid("getPager").pagination({pageNumber:f,pageSize:e,total:n.Data.MaxCount}))},function(t){n.alertErr(t.Msg)})}}catch(s){n.alertErr(s.message)}}function w(){}var n=modules.get(enums.Modules.JQUERY_EASYUI),i=modules.get(enums.Modules.FUNC),t=$("#client_manager_grid"),r=0,u=!1,f=null;try{s();e()}catch(p){n.alertErr(p.message)}return{destroy:w,clientDetail:h}})});